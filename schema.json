{
  "title": "SymLogEntry",
  "type": "object",
  "definitions": {
    "LogEntryMeta": {
      "title": "LogEntryMeta",
      "type": "object",
      "properties": {
        "schema_version": {
          "title": "Schema Version",
          "default": 4,
          "type": "integer"
        }
      }
    },
    "LogEntryError": {
      "title": "LogEntryError",
      "type": "object",
      "properties": {
        "message": {
          "description": "A human-consumable error message.",
          "type": "string"
        },
        "code": {
          "description": "A machine-consumable error code.",
          "type": "string"
        }
      }
    },
    "LogEntryRun": {
      "title": "LogEntryRun",
      "type": "object",
      "properties": {
        "srn": {
          "title": "Srn",
          "type": "string",
          "description": "A Sym Resource Name (SRN) is a unique identifier for a Sym Resource.",
          "pattern": "[a-zA-Z0-9-_]+:[a-zA-Z0-9-_]+:[a-zA-Z0-9-_]+:(latest|[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3})(:[a-zA-Z0-9-_]+)?",
          "examples": [
            "sym:event:approval:1.0.0:requested"
          ]
        },
        "parent": {
          "title": "Parent",
          "type": "string",
          "description": "A Sym Resource Name (SRN) is a unique identifier for a Sym Resource.",
          "pattern": "[a-zA-Z0-9-_]+:[a-zA-Z0-9-_]+:[a-zA-Z0-9-_]+:(latest|[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3})(:[a-zA-Z0-9-_]+)?",
          "examples": [
            "sym:event:approval:1.0.0:requested"
          ]
        },
        "flow": {
          "title": "Flow",
          "type": "string",
          "description": "A Sym Resource Name (SRN) is a unique identifier for a Sym Resource.",
          "pattern": "[a-zA-Z0-9-_]+:[a-zA-Z0-9-_]+:[a-zA-Z0-9-_]+:(latest|[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3})(:[a-zA-Z0-9-_]+)?",
          "examples": [
            "sym:event:approval:1.0.0:requested"
          ]
        }
      },
      "required": [
        "srn",
        "flow"
      ]
    },
    "LogEntryEvent": {
      "title": "LogEntryEvent",
      "type": "object",
      "properties": {
        "srn": {
          "title": "Srn",
          "type": "string",
          "description": "A Sym Resource Name (SRN) is a unique identifier for a Sym Resource.",
          "pattern": "[a-zA-Z0-9-_]+:[a-zA-Z0-9-_]+:[a-zA-Z0-9-_]+:(latest|[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3})(:[a-zA-Z0-9-_]+)?",
          "examples": [
            "sym:event:approval:1.0.0:requested"
          ]
        },
        "type": {
          "title": "Type",
          "type": "string"
        },
        "template": {
          "title": "Template",
          "type": "string",
          "description": "A Sym Resource Name (SRN) is a unique identifier for a Sym Resource.",
          "pattern": "[a-zA-Z0-9-_]+:[a-zA-Z0-9-_]+:[a-zA-Z0-9-_]+:(latest|[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3})(:[a-zA-Z0-9-_]+)?",
          "examples": [
            "sym:event:approval:1.0.0:requested"
          ]
        },
        "timestamp": {
          "title": "Timestamp",
          "type": "string",
          "format": "date-time"
        },
        "channel": {
          "type": "string",
          "enum": [
            "slack",
            "sdk",
            "internal"
          ]
        }
      },
      "required": [
        "srn",
        "type",
        "template",
        "timestamp",
        "channel"
      ]
    },
    "LogEntryIdentity": {
      "title": "LogEntryIdentity",
      "description": "This object will also contain any fields contained in the specific Identity (e.g. the User ID of a Slack User).",
      "type": "object",
      "properties": {
        "service": {
          "title": "Service",
          "type": "string"
        },
        "external_id": {
          "title": "External Id",
          "type": "string"
        }
      },
      "required": [
        "service",
        "external_id"
      ],
      "additionalProperties": true
    },
    "LogEntryActor": {
      "title": "LogEntryActor",
      "type": "object",
      "properties": {
        "user": {
          "title": "User",
          "type": "string",
          "description": "A Sym Resource Name (SRN) is a unique identifier for a Sym Resource.",
          "pattern": "[a-zA-Z0-9-_]+:[a-zA-Z0-9-_]+:[a-zA-Z0-9-_]+:(latest|[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3})(:[a-zA-Z0-9-_]+)?",
          "examples": [
            "sym:event:approval:1.0.0:requested"
          ]
        },
        "name": {
          "title": "Name",
          "type": "string"
        },
        "username": {
          "title": "Username",
          "type": "string"
        },
        "identity": {
          "$ref": "#/definitions/LogEntryIdentity"
        }
      },
      "required": [
        "user",
        "name",
        "identity"
      ]
    },
    "LogEntryTarget": {
      "title": "LogEntryTarget",
      "type": "object",
      "properties": {
        "name": {
          "title": "Name",
          "type": "string"
        },
        "srn": {
          "title": "Srn",
          "type": "string",
          "description": "A Sym Resource Name (SRN) is a unique identifier for a Sym Resource.",
          "pattern": "[a-zA-Z0-9-_]+:[a-zA-Z0-9-_]+:[a-zA-Z0-9-_]+:(latest|[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3})(:[a-zA-Z0-9-_]+)?",
          "examples": [
            "sym:event:approval:1.0.0:requested"
          ]
        },
        "type": {
          "title": "Type",
          "type": "string"
        },
        "label": {
          "title": "Label",
          "type": "string"
        },
        "settings": {
          "title": "Settings",
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        }
      },
      "required": [
        "name",
        "srn",
        "type",
        "label",
        "settings"
      ]
    },
    "LogEntryApprovalFields": {
      "title": "LogEntryApprovalFields",
      "description": "This object will also contain all of the user-supplied fields.",
      "type": "object",
      "properties": {
        "reason": {
          "title": "Reason",
          "type": "string"
        },
        "duration": {
          "title": "Duration",
          "type": "integer"
        },
        "target": {
          "$ref": "#/definitions/LogEntryTarget"
        }
      },
      "required": [
        "reason",
        "duration",
        "target"
      ],
      "additionalProperties": true
    },
    "LogEntryFields": {
      "title": "LogEntryFields",
      "description": "This object will also contain all of the user-supplied fields.",
      "type": "object",
      "properties": {},
      "additionalProperties": true
    }
  },
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "examples": [
    {
      "id": "f1e0b0fe-a1cd-46f2-9772-7ded922d26d1",
      "meta": {
        "schema_version": 4
      },
      "state": {
        "status": "completed",
        "errors": []
      },
      "run": {
        "srn": "healthy-health:run:approval-flow-sandbox:4.0.0:4e41814e-34b2-418c-9582-2d8bc610ea2a",
        "parent": "healthy-health:run:flow_selection:1.0.0:0e6dda1c-f6ad-47ac-9e51-b068dd6f901d",
        "flow": "healthy-health:flow:approval-flow-sandbox:4.0.0"
      },
      "event": {
        "srn": "sym:event-spec:approval:1.0.0:request",
        "type": "request",
        "template": "sym:template:approval:1.0.0",
        "timestamp": "2022-02-15T15:43:45.309236+00:00",
        "channel": "slack"
      },
      "actor": {
        "user": "healthy-health:user:4f36af92-f3a6-4476-b7d4-f7ee82efe088:latest",
        "name": "Ben Bitdiddle",
        "username": "ben@bitdiddle.com",
        "identity": {
          "service": "slack",
          "external_id": "TABC123",
          "user_id": "UABC123"
        }
      },
      "fields": {
        "reason": "foobar",
        "duration": 30,
        "target": {
          "name": "test-target",
          "srn": "healthy-health:target:sandbox-leslielam:latest:request",
          "type": "aws_iam_group",
          "label": "Test Target",
          "settings": {
            "iam_group": "prod-break-glass"
          }
        },
        "urgency": "low",
        "target_id": "1c621be7-8531-4200-a0d3-841e1c88e28b"
      },
      "type": "event"
    }
  ],
  "description": "This model is sent by Sym both to Log Destinations for [reporting](https://docs.symops.com/docs/reporting), as well as for the [HTTP](https://docs.symops.com/docs/http) and [AWS Lambda](https://docs.symops.com/docs/aws-lambda) Strategies.",
  "properties": {
    "id": {
      "type": "string",
      "format": "uuid",
      "example": "f1e0b0fe-a1cd-46f2-9772-7ded922d26d1",
      "description": "A UUID which is guaranteed to be consistent for duplicate records."
    },
    "meta": {
      "$ref": "#/definitions/LogEntryMeta"
    },
    "state": {
      "type": "object",
      "required": [
        "status",
        "errors"
      ],
      "properties": {
        "status": {
          "type": "string",
          "enum": [
            "completed",
            "intercepted",
            "in_progress"
          ]
        },
        "errors": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/LogEntryError"
          }
        }
      }
    },
    "run": {
      "$ref": "#/definitions/LogEntryRun"
    },
    "event": {
      "$ref": "#/definitions/LogEntryEvent"
    },
    "actor": {
      "$ref": "#/definitions/LogEntryActor"
    },
    "fields": {
      "title": "Fields",
      "anyOf": [
        {
          "$ref": "#/definitions/LogEntryApprovalFields"
        },
        {
          "$ref": "#/definitions/LogEntryFields"
        }
      ]
    },
    "type": {
      "type": "string",
      "enum": [
        "event"
      ]
    }
  },
  "required": [
    "id",
    "meta",
    "state",
    "run",
    "event",
    "actor",
    "fields",
    "type"
  ]
}
